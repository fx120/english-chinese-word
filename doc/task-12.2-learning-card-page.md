# 任务 12.2 实现学习卡片页面 - 实施文档

## 任务概述

实现学习卡片页面，这是用户学习单词的主要界面。支持随机和顺序两种学习模式，提供完整的学习流程和统计功能。

## 需求映射

本任务实现以下需求：

### 需求 7: 随机学习模式 (7.1-7.8)
- 7.1: 随机抽取未学习的单词
- 7.2: 显示单词，隐藏释义
- 7.3: 点击显示答案，展示释义、音标、例句
- 7.4: 提供"认识"和"不认识"两个选项
- 7.5: 选择"认识"标记为已掌握
- 7.6: 选择"不认识"标记为需复习
- 7.7: 自动加载下一个随机单词
- 7.8: 完成后显示学习统计

### 需求 8: 顺序学习模式 (8.1-8.9)
- 8.1: 按词表顺序显示未学习的单词
- 8.2: 显示当前学习进度（例如：15/100）
- 8.3: 显示单词，隐藏释义
- 8.4: 点击显示答案，展示释义、音标、例句
- 8.5: 提供"认识"和"不认识"两个选项
- 8.6: 选择"认识"标记为已掌握
- 8.7: 选择"不认识"标记为需复习
- 8.8: 自动加载下一个顺序单词
- 8.9: 完成后显示学习统计

## 实现文件

### 1. 学习卡片页面
**文件**: `app/lib/ui/pages/learning_card_page.dart`

**功能**:
- 显示单词卡片（初始隐藏释义）
- 实现"显示答案"按钮
- 显示释义、音标、例句
- 实现"认识"和"不认识"按钮
- 显示学习进度（如：15/100）
- 自动加载下一个单词
- 显示学习完成统计
- 集成LearningManager

**核心组件**:

#### 状态管理
```dart
LearningSession? _session;        // 学习会话
Word? _currentWord;                // 当前单词
bool _isLoading = true;            // 加载状态
bool _showAnswer = false;          // 是否显示答案
bool _isProcessing = false;        // 是否正在处理
int _currentIndex = 0;             // 当前索引
int _totalWords = 0;               // 总单词数
```

#### 核心方法

1. **开始学习会话**
```dart
Future<void> _startLearningSession()
```
- 调用LearningManager.startLearningSession()
- 获取未学习单词总数
- 加载第一个单词

2. **加载下一个单词**
```dart
Future<void> _loadNextWord()
```
- 调用LearningManager.getNextWord()
- 如果没有更多单词，显示完成统计
- 重置答案显示状态

3. **显示答案**
```dart
void _onShowAnswer()
```
- 设置_showAnswer为true
- 显示释义、音标、例句

4. **标记为认识**
```dart
Future<void> _onKnown()
```
- 调用LearningManager.markWordAsKnown()
- 加载下一个单词

5. **标记为不认识**
```dart
Future<void> _onUnknown()
```
- 调用LearningManager.markWordAsUnknown()
- 加载下一个单词

6. **显示完成统计**
```dart
Future<void> _showCompletionStatistics()
```
- 调用LearningManager.endLearningSession()
- 显示学习统计对话框
- 返回上一页

### 2. 更新学习模式页面
**文件**: `app/lib/ui/pages/learning_mode_page.dart`

**修改内容**:
- 添加LearningCardPage导入
- 实现导航到学习卡片页面
- 学习完成后刷新进度
- 移除未使用的_showInfo方法

## UI设计

### 页面布局

```
┌─────────────────────────────────┐
│ AppBar: 随机学习/顺序学习        │
│                      进度: 15/100│
├─────────────────────────────────┤
│ ▓▓▓▓▓▓▓▓▓░░░░░░░░░░░░░░░░░░░░  │ ← 进度条
├─────────────────────────────────┤
│                                 │
│  ┌───────────────────────────┐  │
│  │                           │  │
│  │        abandon            │  │ ← 单词
│  │                           │  │
│  │   [显示答案按钮]          │  │ ← 未显示答案时
│  │                           │  │
│  │   或                      │  │
│  │                           │  │
│  │   /əˈbændən/              │  │ ← 音标
│  │   v.                      │  │ ← 词性
│  │                           │  │
│  │   释义                    │  │
│  │   放弃；抛弃              │  │ ← 释义
│  │                           │  │
│  │   例句                    │  │
│  │   He abandoned his wife.  │  │ ← 例句
│  │                           │  │
│  └───────────────────────────┘  │
│                                 │
│  ┌──────────┐  ┌──────────┐    │
│  │ 不认识   │  │  认识    │    │ ← 操作按钮
│  └──────────┘  └──────────┘    │
│                                 │
└─────────────────────────────────┘
```

### 完成统计对话框

```
┌─────────────────────────────────┐
│ 🎉 学习完成！                    │
├─────────────────────────────────┤
│                                 │
│  📚 学习单词: 20                │
│  ✅ 认识: 15                    │
│  ⚠️  不认识: 5                  │
│  ⏱️  学习时长: 10分30秒          │
│                                 │
│  💡 继续保持学习，记得定期复习哦！│
│                                 │
│                      [完成]     │
└─────────────────────────────────┘
```

## 用户交互流程

### 学习流程

1. **进入页面**
   - 显示加载指示器
   - 开始学习会话
   - 加载第一个单词

2. **查看单词**
   - 显示单词文本
   - 隐藏释义、音标、例句
   - 显示"显示答案"按钮

3. **显示答案**
   - 点击"显示答案"按钮
   - 显示音标（如果有）
   - 显示词性（如果有）
   - 显示释义
   - 显示例句（如果有）
   - 显示"认识"和"不认识"按钮

4. **标记单词**
   - 点击"认识"或"不认识"
   - 保存学习进度
   - 自动加载下一个单词

5. **完成学习**
   - 没有更多单词时
   - 显示完成统计对话框
   - 返回学习模式页面

### 退出流程

1. **点击返回按钮**
   - 显示确认对话框
   - 选择"退出"结束会话
   - 选择"取消"继续学习

## 集成点

### 与LearningManager集成

```dart
// 开始学习会话
final session = await learningManager.startLearningSession(listId, mode);

// 获取下一个单词
final word = await learningManager.getNextWord(session);

// 标记为认识
await learningManager.markWordAsKnown(wordId, listId);

// 标记为不认识
await learningManager.markWordAsUnknown(wordId, listId);

// 结束学习会话
final statistics = await learningManager.endLearningSession(session);
```

### 与LearningProvider集成

```dart
// 通过Provider获取LearningManager
final learningManager = context.read<LearningProvider>().learningManager;
```

## 状态管理

### 页面状态

- **加载中**: 显示CircularProgressIndicator
- **显示单词**: 显示单词卡片和"显示答案"按钮
- **显示答案**: 显示完整答案和操作按钮
- **处理中**: 禁用操作按钮，防止重复点击
- **完成**: 显示统计对话框

### 会话状态

- 通过LearningSession跟踪当前学习会话
- 记录已学习的单词ID
- 记录认识和不认识的单词数量
- 计算学习时长

## 错误处理

### 异常情况

1. **启动会话失败**
   - 显示错误提示
   - 返回上一页

2. **加载单词失败**
   - 显示错误提示
   - 保持当前状态

3. **标记失败**
   - 显示错误提示
   - 不加载下一个单词

4. **结束会话失败**
   - 显示错误提示
   - 返回上一页

### 边界情况

1. **没有可学习的单词**
   - 在学习模式页面已检查
   - 页面显示提示信息

2. **会话被中断**
   - 用户点击返回按钮
   - 显示确认对话框
   - 保存当前进度

## 性能优化

### 加载优化

- 异步加载单词数据
- 显示加载指示器
- 避免阻塞UI线程

### 内存管理

- 及时释放资源
- dispose时结束会话
- 清理状态变量

### 用户体验

- 防止重复点击（_isProcessing标志）
- 平滑的状态转换
- 清晰的进度指示

## 测试要点

### 功能测试

1. **随机学习模式**
   - 验证单词随机选择
   - 验证不重复显示

2. **顺序学习模式**
   - 验证单词顺序显示
   - 验证进度计算正确

3. **答案显示**
   - 验证初始隐藏
   - 验证点击后显示

4. **标记功能**
   - 验证"认识"更新状态
   - 验证"不认识"更新状态
   - 验证自动加载下一个

5. **完成统计**
   - 验证统计数据正确
   - 验证时长计算正确

### UI测试

1. **布局测试**
   - 验证各元素正确显示
   - 验证响应式布局

2. **交互测试**
   - 验证按钮可点击
   - 验证状态切换

3. **导航测试**
   - 验证页面跳转
   - 验证返回处理

### 集成测试

1. **与LearningManager集成**
   - 验证会话管理
   - 验证数据持久化

2. **与数据库集成**
   - 验证进度保存
   - 验证数据一致性

## 实现总结

### 完成的功能

✅ 学习卡片页面UI实现
✅ 随机学习模式支持
✅ 顺序学习模式支持
✅ 答案显示/隐藏功能
✅ 认识/不认识标记功能
✅ 学习进度显示
✅ 自动加载下一个单词
✅ 学习完成统计
✅ 退出确认对话框
✅ 与LearningManager集成
✅ 错误处理和边界情况处理

### 代码质量

- ✅ 遵循Flutter代码规范
- ✅ 完整的注释文档
- ✅ 清晰的代码结构
- ✅ 适当的错误处理
- ✅ 无诊断警告

### 用户体验

- ✅ 直观的UI设计
- ✅ 流畅的交互体验
- ✅ 清晰的进度指示
- ✅ 友好的错误提示
- ✅ 完整的学习统计

## 后续任务

本任务完成后，下一步可以实现：

- 任务 12.3: 实现复习模式选择页面
- 任务 12.4: 实现复习卡片页面
- 任务 13.1: 实现统计页面

## 文件清单

### 新增文件
- `app/lib/ui/pages/learning_card_page.dart` - 学习卡片页面

### 修改文件
- `app/lib/ui/pages/learning_mode_page.dart` - 添加导航功能

### 文档文件
- `doc/task-12.2-learning-card-page.md` - 本文档

## 验证清单

- [x] 代码无诊断错误
- [x] 遵循项目目录结构规范
- [x] 前端代码放在app/目录
- [x] 文档放在doc/目录
- [x] 实现所有需求功能
- [x] 集成LearningManager
- [x] 错误处理完整
- [x] 用户体验良好
- [x] 代码注释完整

## 实施日期

2024年（任务执行日期）

## 实施人员

Kiro AI Assistant
